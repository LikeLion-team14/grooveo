<html xmlns="http://www.w3.org/1999/html">

<head>
    <!-- 파비콘 -->
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <!-- 제이쿼리 불러오기 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- 폰트어썸 아이콘 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- toastr 불러오기 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>
    <link rel="stylesheet" href="https://jhs512.github.io/toastr/toastr.css">

    <!-- 공통 JS 불러오기 -->
    <script src="/resource/common/common.js"></script>

    <!-- 공통 CSS 불러오기 -->
    <link rel="stylesheet" href="/resource/common/common.css">

    <!-- 모달 CSS 불러오기 -->
    <link rel="stylesheet" href="/resource/common/modal.css">

    <!-- 데이지 UI 불러오기 -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.0.4/dist/full.css" rel="stylesheet" type="text/css"/>

    <!-- 테일윈드 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <title></title>
</head>

<body>
<header class="top-bar bg-black bg-opacity-90">
    <div class="con mx-auto pr-3 h-full flex">
        <a href="/" class="logo text-lg font-bold flex items-center px-3">
            GROOVEO
        </a>

        <div class="flex-grow"></div>
            <div class="flex h-full items-center">
                <a th:if="${@rq.logout}" class="btn btn-ghost rounded-btn" href="/usr/member/login">로그인</a>
                <a th:if="${@rq.logout}" class="btn btn-ghost rounded-btn" href="/usr/member/join">가입하기</a>
                <a th:if="${@rq.login}" class="btn btn-ghost rounded-btn" href="/library/list/1">라이브러리</a>
                <div th:if="${@rq.login}" class="dropdown">
                    <label tabindex="0" class="btn btn-ghost rounded-btn">커뮤니티</label>
                    <ul tabindex="0" class="menu dropdown-content p-2 shadow bg-base-100 rounded-box w-33 mt-4">
                        <li><a href="/community/freedomPost/1/list" style="color: black;">국외 게시판</a></li>
                        <li><a href="/community/freedomPost/2/list" style="color: black;">국내 게시판</a></li>
                    </ul>
                </div>
                <a th:if="${@rq.login}" class="btn btn-ghost rounded-btn" href="/usr/member/myPage/library">내 정보</a>
                <a th:if="${@rq.login}" class="btn btn-ghost rounded-btn" href="javascript:" onclick="$(this).next().submit();">로그아웃</a>
                <form class="!hidden" hidden th:action="|/usr/member/logout|" method="POST"></form>
                <a id="openModalButton1" class="btn btn-ghost btn-circle" th:if="${@rq.login}">
                    <div class="indicator" style="position: relative;">
                        <i class="fa-regular fa-bell">
                            <span data-test="hasUnreadNotifications" th:if="${@rq.hasUnreadNotifications()}"
                                  class="badge badge-xs badge-secondary indicator-item" style="position: absolute; top: -5px; right: -5px;"></span>
                        </i>
                    </div>
                </a>
        </div>
    </div>
</header>

<div class="mx-auto min-h-xl">
    <!-- Notification Modal -->
    <div id="notificationModal" class="modal1 hidden text-black">
        <div class="flex flex-col modal1-content justify-end">
            <div id="modalContent1">
                <!-- 모달창 안에 내용 -->
            </div>
        </div>
    </div>
</div>

<main layout:fragment="main"></main>

<footer class="footer p-10 bg-neutral text-neutral-content">
    <div class="flex justify-between w-full">
        <div>
            <svg width="50" height="50" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" class="fill-current"><path d="M22.672 15.226l-2.432.811.841 2.515c.33 1.019-.209 2.127-1.23 2.456-1.15.325-2.148-.321-2.463-1.226l-.84-2.518-5.013 1.677.84 2.517c.391 1.203-.434 2.542-1.831 2.542-.88 0-1.601-.564-1.86-1.314l-.842-2.516-2.431.809c-1.135.328-2.145-.317-2.463-1.229-.329-1.018.211-2.127 1.231-2.456l2.432-.809-1.621-4.823-2.432.808c-1.355.384-2.558-.59-2.558-1.839 0-.817.509-1.582 1.327-1.846l2.433-.809-.842-2.515c-.33-1.02.211-2.129 1.232-2.458 1.02-.329 2.13.209 2.461 1.229l.842 2.515 5.011-1.677-.839-2.517c-.403-1.238.484-2.553 1.843-2.553.819 0 1.585.509 1.85 1.326l.841 2.517 2.431-.81c1.02-.33 2.131.211 2.461 1.229.332 1.018-.21 2.126-1.23 2.456l-2.433.809 1.622 4.823 2.433-.809c1.242-.401 2.557.484 2.557 1.838 0 .819-.51 1.583-1.328 1.847m-8.992-6.428l-5.01 1.675 1.619 4.828 5.011-1.674-1.62-4.829z"></path></svg>
            <p>Copyright © 2023 Grooveo Inc.<br/>All rights reserved.<br/>Providing reliable tech since 2023.</p>
        </div>
        <div>
            <span class="footer-title">Social</span>
            <div class="grid grid-flow-col gap-4">
                <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"></path></svg></a>
                <a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"></path></svg></a>
                <a target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"></path></svg></a>
            </div>
        </div>
    </div>
</footer>

<script th:inline="javascript">
    // 타임리프 문법(파라미터, ? 뒤에 입력된 매개변수들)
    const params = /*[[ ${param} ]]*/ null;

    if (params.msg) {
        toastNotice(params.msg[0]);
    }

    if (params.errorMsg) {
        toastWarning(params.errorMsg[0]);
    }

    // history.back 에 의해서 돌아온 경우에 실행됨
    // 평소에도 실행됨
    $(window).bind("pageshow", function (event) {
        const localStorageKeyAboutHistoryBackErrorMsg = "historyBackErrorMsg___" + location.href;

        if (localStorage.getItem(localStorageKeyAboutHistoryBackErrorMsg)) {
            toastWarning(localStorage.getItem(localStorageKeyAboutHistoryBackErrorMsg));
            localStorage.removeItem(localStorageKeyAboutHistoryBackErrorMsg);
        } else if (!document.referrer) {
            const localStorageKeyAboutHistoryBackErrorMsg = "historyBackErrorMsg___null";

            if (localStorage.getItem(localStorageKeyAboutHistoryBackErrorMsg)) {
                toastWarning(localStorage.getItem(localStorageKeyAboutHistoryBackErrorMsg));
                localStorage.removeItem(localStorageKeyAboutHistoryBackErrorMsg);
            }
        }
    });
</script>

<script>
    // 모달 열기
    const openModalButton = document.getElementById("openModalButton1");
    if (openModalButton != null) {
        openModalButton.onclick = function () {
            if (!modal.classList.contains("hidden")) {
                closeModal();
                return false;
            }
            // AJAX 요청 보내기
            $.ajax({
                url: "/usr/notification/list", // 컨트롤러의 엔드포인트 주소를 입력하세요.
                method: "GET", // GET 또는 POST 방식을 선택하세요.
                success: function (data) {
                    // 요청이 성공하면 반환된 데이터를 사용하여 모달 내용 업데이트
                    const modalContent = document.getElementById("modalContent1");
                    modalContent.innerHTML = data;

                    // 모달 열기
                    const modal = document.getElementById("notificationModal");
                    modal.classList.remove("hidden");
                },
                error: function (xhr, status, error) {
                    // 요청이 실패한 경우 에러 처리
                    console.error(error);
                }
            });
            return false;
        }
    }

    function closeModal() {
        const modal = document.getElementById("notificationModal");
        modal.classList.add("hidden");
    }

    // 모달 닫기
    const modal = document.getElementById("notificationModal");
    modal.onclick = function (event) {
        if (event.target === modal) {
            closeModal();
        }
    };

    // 클릭 이벤트 핸들러 함수
    function EyeIconClick(el) {
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");

        const notificationId = $(el).attr("data-id");
        if (notificationId) {
            // Ajax 요청 설정
            $.ajax({
                type: "POST",
                url: "/usr/notification/readNotification",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(header, token);
                },
                data: {
                    notificationId: notificationId
                },
                dataType: "text",
                success: function (result) {
                    if (result === 'success') {
                        const newHtml = '<i class="fa-regular fa-eye-slash"></i>'
                        $(el).html(newHtml)
                    } else {
                        toastWarning('해당 알림이 없습니다.');
                    }
                }
            });
        }
    }

    function TrashCanIconClick(el) {
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");

        const notificationId = $(el).attr("data-id");
        if (notificationId) {
            // Ajax 요청 설정
            $.ajax({
                type: "POST",
                url: "/usr/notification/deleteNotification",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(header, token);
                },
                data: {
                    notificationId: notificationId
                },
                dataType: "text",
                success: function (result) {
                    if (result === 'success') {
                        openModalButton.click();
                        openModalButton.click();
                    } else {
                        toastWarning('해당 알림이 없습니다.');
                    }
                }
            });
        }
    }

    function AllDelete(el) {
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");

        const deleteType = parseInt($(el).attr("data-id"));
        if (deleteType) {
            // Ajax 요청 설정
            $.ajax({
                type: "POST",
                url: "/usr/notification/allDelete",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(header, token);
                },
                data: {
                    deleteType: deleteType
                },
                dataType: "text",
                success: function (result) {
                    if (result === 'success') {
                        openModalButton.click();
                        openModalButton.click();
                    } else {
                        toastWarning('삭제하지 못 했습니다.');
                    }
                }
            });
        }
    }
</script>

</body>

</html>